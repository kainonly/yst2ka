package yst2ka_test

import (
	"context"
	"testing"

	"github.com/kainonly/go/help"
	"github.com/kainonly/yst2ka"
	"github.com/stretchr/testify/assert"
)

func TestYst2Ka_Tm1010(t *testing.T) {
	ctx := context.TODO()
	code := `SUP10001`
	num := Num(`X`, code, `0`)

	// 收付通绑卡（绑卡方式6）测试参数（注释版，便于直接参考）
	// 规则说明：通过卡号结尾数字控制模拟结果，搭配虚构身份证号（仅测试用，非真实信息）
	// 1. 卡号尾号0 - 绑卡成功（正常流程验证）- 身份证号：110101199001010010
	// 2. 卡号尾号1 - 绑卡成功（正常流程验证）- 身份证号：310101199505050021
	// 3. 卡号尾号9 - 绑卡成功（正常流程验证）- 身份证号：440101200010100039
	// 4. 卡号尾号2 - 无效卡号（卡号格式/有效性校验）- 身份证号：510101198503030042
	// 5. 卡号尾号3 - 已挂失卡（卡片状态异常校验）- 身份证号：610101199207070053
	// 6. 卡号尾号4 - 余额不足（扣款能力校验，若绑卡需预授权）- 身份证号：210101198809090064
	// 7. 卡号尾号5 - 无此账户（账户存在性校验）- 身份证号：330101199311110075
	// 8. 卡号尾号6 - 无此原交易（关联原交易校验，如续绑场景）- 身份证号：420101198602020086
	// 9. 卡号尾号7 - 户名错（持卡人姓名与卡号一致性校验）- 身份证号：120101199104040097
	// 10. 卡号尾号8 - 交易超时（网络/系统稳定性校验）- 身份证号：530101198906060108
	cerNum, err := help.SM4Encrypt(secretKey, `51370119380325580x`)
	assert.NoError(t, err)

	// 正确19位卡号集合：
	// 交易成功（第4位0，621026开头）：6210260123456789012
	// 查开户方原因（第4位1）：6222021123456789013
	// 无效卡号（第4位2，621226开头）：6212262123456789014
	// 已挂失卡（第4位3）：6228483123456789015
	// 余额不足（第4位4）：6217004123456789016
	// 无此账户（第4位5，621226开头）：6212265123456789017
	// 原交易失败，不收费（第4位6）：6230586123456789018
	// 户名错（第4位7）：6214837123456789019
	// 交易超时（第4位8）：6229088123456789020
	acctNum, err := help.SM4Encrypt(secretKey, `6210260123456789012`)
	assert.NoError(t, err)

	dto := yst2ka.NewTm1010Dto(num, code, `王三华`, `1`, cerNum).
		SetMemberRole(`门店`).
		SetPhone(`12312341234`).
		//SetBindType(`6`).
		SetAcctNum(acctNum)

	r, err := x.Tm1010(ctx, dto)
	assert.NoError(t, err)

	t.Log(r)

	t.Log(`code:`, r.RespCode)
	t.Log(`msg:`, r.RespMsg)
	t.Log(`respTraceNum:`, r.RespTraceNum)
	t.Log(`signNum:`, r.SignNum)
}
